package net.ccbluex.liquidbounce.features.module.modules.exploit

import net.ccbluex.liquidbounce.event.EventTarget
import net.ccbluex.liquidbounce.event.UpdateEvent
import net.ccbluex.liquidbounce.features.module.Module
import net.ccbluex.liquidbounce.features.module.ModuleCategory
import net.ccbluex.liquidbounce.features.module.ModuleInfo
import net.ccbluex.liquidbounce.value.IntegerValue
import net.ccbluex.liquidbounce.utils.ClientUtils
import net.ccbluex.liquidbounce.utils.timer.MSTimer
import net.ccbluex.liquidbounce.utils.timer.TimeUtils
import net.minecraft.item.Item
import net.minecraft.item.ItemAxe

@ModuleInfo(name = "MiaoRenChecker", category = ModuleCategory.EXPLOIT)
class MiaoRenChecker : Module() {
    private val DelayValue = IntegerValue("Delay", 1000, 0, 10000)

    private val msTimer = MSTimer()
    private var delay = TimeUtils.randomDelay(DelayValue.get(), DelayValue.get())
    private val detectedPlayers = mutableSetOf<String>()

    @EventTarget
    fun onUpdate(event: UpdateEvent) {
        for (player in mc.theWorld!!.playerEntities) {
            if (player.heldItem?.item is ItemAxe && (player.heldItem?.item as ItemAxe).toolMaterialName == Item.ToolMaterial.GOLD.toString() && player.heldItem!!.itemDamage >=25 && !detectedPlayers.contains(player.name)) {
                player.name?.let { detectedPlayers.add(it) }
                ClientUtils.displayChatMessage("§7[§8§lFDPCNClientCN§7]§f:" + player.name + "§c拥有秒人斧")
            }
            if(msTimer.hasTimePassed(delay)) {
                msTimer.reset()
                detectedPlayers.clear()
            }
        }
    }
}
